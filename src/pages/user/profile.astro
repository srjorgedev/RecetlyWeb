---
import MainLayout from "../../layouts/MainLayout.astro";
const cookies = Astro.request.headers.get("cookie");
let token = null;
let data = null;

if (cookies) {
    token = cookies.split(";").reduce((acc, cookie) => {
        const [key, value] = cookie.trim().split("=");
        if (key === "token") acc = value;
        return acc;
    }, "");
}

if (token !== null) {
    const response = await fetch(
        `https://app.recetly.net/api/v1/auth/get/${token}`,
        { method: "GET" },
    );
    data = await response.json();

    console.log(data);
}
---

<MainLayout title={data.user.userNickname}>
    <section
        class="profile-picture"
        style={`background-color: ${data.user.userColor};`}
    >
        <img src={data.user.userImg} />
    </section>

    <section class="personal-info">
        <strong> <p>{data.user.userNickname}</p></strong>
        <p>{`${data.user.userName} ${data.user.userLastName}`}</p>
    </section>

    <p class="subtitle">Sobre m√≠</p>
    <section class="about-me">
        <p>{data.user.userDescription}</p>
    </section>
    <p class="subtitle">Mis recetas</p>
    <section class="recipes">
    </section>
</MainLayout>

<style>
    section {
        border-radius: 2rem;
    }

    section.profile-picture {
        width: 100%;
        display: flex;
        aspect-ratio: 6;
        position: relative;

        & img {
            position: absolute;
            width: 15rem;
            aspect-ratio: 1;
            border-radius: 50%;
            right: 10rem;
            bottom: -6.5rem;
            border: 2px solid #f1f1f1;
        }
    }
    section.personal-info {
        padding: 1rem 2rem;
        border: 2px solid #e9e9e9;

        & p {
            font-size: 3.5rem;
        }
        & p:nth-child(2) {
            font-size: 2.5rem;
        }
    }

    p.subtitle {
        font-size: 2.5rem;
    }

    section.about-me {
        padding: 1rem 2rem;
        border: 2px solid #e9e9e9;

        & p {
            font-size: 2.25rem;
        }
    }
</style>
